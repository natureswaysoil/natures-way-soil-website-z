# 0) Safety backup of whatever is there now
cp -f package.json package.json.bak 2>/dev/null || true

# 1) Write a clean package.json (NO comments, NO extra text)
cat > package.json <<'JSON'
{
  "name": "natureswaysoil-site",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint .",
    "format": "prettier --write ."
  },
  "dependencies": {
    "@radix-ui/react-slot": "1.0.2",
    "autoprefixer": "10.4.20",
    "class-variance-authority": "0.7.0",
    "clsx": "2.1.1",
    "lucide-react": "0.446.0",
    "next": "15.0.0",
    "postcss": "8.4.41",
    "react": "18.3.1",
    "react-dom": "18.3.1",
    "tailwind-variants": "0.2.1",
    "tailwindcss": "3.4.10",
    "@stripe/stripe-js": "^3.4.1",
    "stripe": "^16.6.0",
    "openai": "^4.58.1"
  },
  "devDependencies": {
    "@eslint/js": "9.9.0",
    "eslint": "9.33.0",
    "eslint-config-next": "15.0.0",
    "typescript": "5.5.4"
  },
  "engines": {
    "node": ">=20 <21"
  }
}
JSON

# 2) Validate JSON (this will throw if anything is malformed)
node -e "JSON.parse(require('fs').readFileSync('package.json','utf8')); console.log('package.json âœ… valid')"

# 3) Recreate lockfile cleanly
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps

# 4) If a rebase is in progress, continue; otherwise commit
if [ -d .git/rebase-merge ] || [ -d .git/rebase-apply ]; then
  git add package.json package-lock.json
  git rebase --continue
else
  git add package.json package-lock.json
  git commit -m "Fix package.json; regenerate lockfile"
fi

# 5) Ensure HTTPS remote and push
git remote set-url origin https://github.com/natureswaysoil/natures-way-soil-website-z.git
git push -u origin main


